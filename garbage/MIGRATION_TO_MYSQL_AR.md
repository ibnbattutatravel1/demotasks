# ๐ ุฏููู ุงูุชุญููู ูู SQLite (Turso) ุฅูู MySQL

ูุฐุง ุงูุฏููู ุณูุณุงุนุฏู ุนูู ุชุญููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู SQLite (Turso) ุฅูู MySQL ุจุฃูุงู ุชุงู ูุจุฏูู ููุฏุงู ุฃู ุจูุงูุงุช.

## ๐ ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

### 1. ุชุซุจูุช MySQL
- ูู ุจุชุซุจูุช MySQL Server (ุงููุณุฎุฉ 8.0 ุฃู ุฃุญุฏุซ)
- ุชุฃูุฏ ูู ุฃู MySQL ูุนูู ุจุดูู ุตุญูุญ

### 2. ุชุญุฏูุซ Dependencies
ุฃุถู ุงูููุชุจุงุช ุงููุทููุจุฉ:

```bash
npm install mysql2 drizzle-orm@latest
```

### 3. ุชุฌููุฒ ูุนูููุงุช ุงูุงุชุตุงู ุจู MySQL
ุณุชุญุชุงุฌ ุฅูู:
- `MYSQL_HOST`: ุนููุงู ุงูุณูุฑูุฑ (ูุซู: localhost ุฃู ุนููุงู IP)
- `MYSQL_PORT`: ุงููููุฐ (ุงูุชุฑุงุถูุงู: 3306)
- `MYSQL_USER`: ุงุณู ุงููุณุชุฎุฏู
- `MYSQL_PASSWORD`: ูููุฉ ุงููุฑูุฑ
- `MYSQL_DATABASE`: ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุซู: demotasks)

---

## ๐ ุฎุทูุงุช ุงูุชุญููู

### ุงููุฑุญูุฉ 1๏ธโฃ: ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช MySQL

#### 1. ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
ูู ุจุชุดุบูู ุงูุณูุฑูุจุช ุงูุชุงูู ูู MySQL:

```bash
mysql -u root -p < scripts/migrate-to-mysql/00-setup-mysql.sql
```

ุฃู ุงูุชุญ MySQL client ููู ุจุชูููุฐ:
```sql
CREATE DATABASE IF NOT EXISTS demotasks 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;
```

#### 2. ุฅูุดุงุก ุงูุฌุฏุงูู ุจุงุณุชุฎุฏุงู Drizzle
```bash
# ุฅูุดุงุก ูููุงุช ุงูู migration
npx drizzle-kit generate --config=drizzle.config.mysql.ts

# ุชุทุจูู ุงูู migrations ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
npx drizzle-kit push --config=drizzle.config.mysql.ts
```

---

### ุงููุฑุญูุฉ 2๏ธโฃ: ุชุตุฏูุฑ ุงูุจูุงูุงุช ูู SQLite (Turso)

โ๏ธ **ููู**: ุชุฃูุฏ ูู ุฃู ููู `.env` ูุญุชูู ุนูู ูุนูููุงุช ุงูุงุชุตุงู ุจู Turso:
```env
LIBSQL_URL=libsql://demotasks-ibnbattutatravel1.aws-us-west-2.turso.io
LIBSQL_AUTH_TOKEN=eyJhbGci...
```

ูู ุจุชุดุบูู ุณูุฑูุจุช ุงูุชุตุฏูุฑ:
```bash
npx tsx scripts/migrate-to-mysql/01-export-sqlite-data.ts
```

ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจู:
- โ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช Turso
- โ ุชุตุฏูุฑ ุฌููุน ุงูุจูุงูุงุช ูู ูู ุงูุฌุฏุงูู
- โ ุญูุธ ุงูุจูุงูุงุช ูู ูููุงุช JSON ูู ุงููุฌูุฏ `scripts/migrate-to-mysql/exported-data/`
- โ ุฅูุดุงุก ููู ููุฎุต `_export_summary.json`

**ุชุญูู ูู ูุฌุงุญ ุงูุนูููุฉ:**
- ุงูุชุญ ุงููุฌูุฏ `scripts/migrate-to-mysql/exported-data/`
- ุชุฃูุฏ ูู ูุฌูุฏ ูููุงุช JSON ููู ุฌุฏูู
- ุงูุชุญ `_export_summary.json` ููุชุญูู ูู ุนุฏุฏ ุงูุตููู ุงููุตุฏุฑุฉ

---

### ุงููุฑุญูุฉ 3๏ธโฃ: ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุฅูู MySQL

โ๏ธ **ููู**: ุฃุถู ูุนูููุงุช ุงูุงุชุตุงู ุจู MySQL ุฅูู ููู `.env`:
```env
# ุจูุงูุงุช MySQL ุงูุฌุฏูุฏุฉ
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=demotasks

# ุจูุงูุงุช Turso ุงููุฏููุฉ (ุงุญุชูุธ ุจูุง ููุงุญุชูุงุท)
LIBSQL_URL=libsql://demotasks-ibnbattutatravel1.aws-us-west-2.turso.io
LIBSQL_AUTH_TOKEN=eyJhbGci...
```

ูู ุจุชุดุบูู ุณูุฑูุจุช ุงูุงุณุชูุฑุงุฏ:
```bash
npx tsx scripts/migrate-to-mysql/02-import-to-mysql.ts
```

ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจู:
- โ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช MySQL
- โ ุงุณุชูุฑุงุฏ ุฌููุน ุงูุจูุงูุงุช ูู ูููุงุช JSON
- โ ุชุญููู ุฃููุงุน ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ (boolean, datetime, ุฅูุฎ)
- โ ุฅุธูุงุฑ ููุฎุต ุงูุนูููุฉ

---

### ุงููุฑุญูุฉ 4๏ธโฃ: ุชุญุฏูุซ ุงูุชุทุจูู ููุณุชุฎุฏู MySQL

#### 1. ุชุญุฏูุซ ููู client
ุนุฏูู ุงูููู `lib/db/client.ts`:

**ุงูุทุฑููุฉ ุงูุฃููู - ุงูุชุญุฏูุซ ุงููุงูู (ููุตู ุจูุง):**
```typescript
// ุงุณุชุจุฏู ูุญุชูู ุงูููู ุจุงููุงูู ุจู:
import * as schema from './schema-mysql'
import { drizzle } from 'drizzle-orm/mysql2'
import mysql from 'mysql2/promise'

function makeDb() {
  if (!process.env.MYSQL_HOST || !process.env.MYSQL_USER || !process.env.MYSQL_DATABASE) {
    throw new Error(
      'Database misconfiguration: MYSQL_HOST, MYSQL_USER, and MYSQL_DATABASE must be set.'
    )
  }

  const poolConnection = mysql.createPool({
    host: process.env.MYSQL_HOST,
    port: parseInt(process.env.MYSQL_PORT || '3306'),
    user: process.env.MYSQL_USER,
    password: process.env.MYSQL_PASSWORD,
    database: process.env.MYSQL_DATABASE,
    waitForConnections: true,
    connectionLimit: 10,
    queueLimit: 0,
    enableKeepAlive: true,
    keepAliveInitialDelay: 0,
  })

  return drizzle(poolConnection, { schema, mode: 'default' })
}

export const db = makeDb() as any
export type DB = typeof db
export * as dbSchema from './schema-mysql'
```

**ุงูุทุฑููุฉ ุงูุซุงููุฉ - ุงูุชุญุฏูุซ ุงูุชุฏุฑูุฌู (ููุงุฎุชุจุงุฑ):**
ููููู ุฅุถุงูุฉ ูุชุบูุฑ ุจูุฆุฉ ููุชุจุฏูู ุจูู ููุงุนุฏ ุงูุจูุงูุงุช:
```typescript
// ูู lib/db/client.ts
function makeDb() {
  // ุงุณุชุฎุฏู MySQL ุฅุฐุง ูุงู USE_MYSQL=true
  if (process.env.USE_MYSQL === 'true') {
    // ููุฏ MySQL...
  }
  
  // ูุฅูุง ุงุณุชุฎุฏู SQLite ููุง ูู
  if (process.env.LIBSQL_URL) {
    // ููุฏ Turso ุงูุญุงูู...
  }
}
```

#### 2. ุชุญุฏูุซ ููู schema
ุงุณุชุจุฏู ุงุณุชูุฑุงุฏ schema ูู `lib/db/client.ts`:
```typescript
// ุจุฏูุงู ูู
import * as schema from './schema'

// ุงุณุชุฎุฏู
import * as schema from './schema-mysql'
```

#### 3. ุชุญุฏูุซ drizzle.config.ts
ุงูุณุฎ ุฅุนุฏุงุฏุงุช MySQL:
```bash
# ููููู ูุณุฎ ุงูููู ุฃู ุชุญุฏูุซ ุงูููุฌูุฏ
cp drizzle.config.mysql.ts drizzle.config.ts
```

---

### ุงููุฑุญูุฉ 5๏ธโฃ: ุงุฎุชุจุงุฑ ุงูุชุทุจูู

#### 1. ุงุฎุชุจุงุฑ ูุญูู
```bash
# ุชุฃูุฏ ูู ุฃู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุตุญูุญุฉ ูู .env
# ุซู ูู ุจุชุดุบูู ุงูุชุทุจูู
npm run dev
```

#### 2. ุงูุชุญูู ูู ุงูุจูุงูุงุช
- ุงูุชุญ ุงูุชุทุจูู ูู ุงููุชุตูุญ
- ุชุญูู ูู:
  - โ ุนุฑุถ ุงููุดุงุฑูุน ูุงูููุงู
  - โ ุฅูุดุงุก ูููุฉ ุฌุฏูุฏุฉ
  - โ ุชุญุฏูุซ ูููุฉ ููุฌูุฏุฉ
  - โ ุญุฐู ุนูุตุฑ
  - โ ุชุณุฌูู ุงูุฏุฎูู ูุงูุฎุฑูุฌ

#### 3. ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ
```bash
# ุงุณุชุฎุฏู Drizzle Studio
npx drizzle-kit studio --config=drizzle.config.mysql.ts

# ุฃู ุงุณุชุฎุฏู MySQL client
mysql -u root -p demotasks
```

---

## ๐ ููุงุฑูุฉ ุงูุฃุฏุงุก

### SQLite (Turso)
- โ ุณุฑูุน ูููุฑุงุกุฉ
- โ๏ธ ูุญุฏูุฏ ูู ุงููุชุงุจุฉ ุงููุชุฒุงููุฉ
- โ๏ธ ูุญุฏูุฏ ูู ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### MySQL
- โ ุฃูุถู ูููุชุงุจุฉ ุงููุชุฒุงููุฉ
- โ ูุฏุนู ููุงุนุฏ ุจูุงูุงุช ูุจูุฑุฉ ุฌุฏุงู
- โ ุฅููุงููุงุช ูุชูุฏูุฉ (triggers, stored procedures)
- โ ุณูููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "Cannot connect to MySQL"
**ุงูุญู:**
1. ุชุญูู ูู ุฃู MySQL ูุนูู: `sudo systemctl status mysql`
2. ุชุญูู ูู ูุนูููุงุช ุงูุงุชุตุงู ูู `.env`
3. ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูุฏูู ุตูุงุญูุงุช: `GRANT ALL PRIVILEGES ON demotasks.* TO 'user'@'localhost';`

### ุฎุทุฃ: "Foreign key constraint fails"
**ุงูุญู:**
- ุชุฃูุฏ ูู ุชุดุบูู ุณูุฑูุจุช ุงูุงุณุชูุฑุงุฏ ุจุงูุชุฑุชูุจ ุงูุตุญูุญ (ุงููุณุชุฎุฏููู ุฃููุงูุ ุซู ุงููุดุงุฑูุนุ ุฅูุฎ)
- ุงูุณูุฑูุจุช ูุนุทู ูุญุต ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ ูุคูุชุงูุ ุชุฃูุฏ ูู ุฃูู ูุนูู ุจุดูู ุตุญูุญ

### ุฎุทุฃ: "Data truncated"
**ุงูุญู:**
- ุชุญูู ูู ุฃู ุฃุญุฌุงู ุงูุญููู ูู schema-mysql.ts ูุงููุฉ
- ุฎุงุตุฉ ุญููู varchar - ูุฏ ุชุญุชุงุฌ ูุฒูุงุฏุฉ ุงูุทูู

### ุงูุจูุงูุงุช ุบูุฑ ููุชููุฉ ุจุนุฏ ุงูุงุณุชูุฑุงุฏ
**ุงูุญู:**
1. ุงูุชุญ `scripts/migrate-to-mysql/exported-data/_export_summary.json`
2. ูุงุฑู ุนุฏุฏ ุงูุตููู ุงููุตุฏุฑุฉ ูุน ุงููุณุชูุฑุฏุฉ
3. ุฃุนุฏ ุชุดุบูู ุณูุฑูุจุช ุงูุงุณุชูุฑุงุฏ ูุน ุชูุฑูุบ ุงูุฌุฏุงูู ุฃููุงู:
```sql
SET FOREIGN_KEY_CHECKS = 0;
TRUNCATE TABLE users;
TRUNCATE TABLE projects;
-- ... ุฅูุฎ
SET FOREIGN_KEY_CHECKS = 1;
```

---

## ๐ ุงููุณุฎ ุงูุงุญุชูุงุทู

### ูุจู ุงูุชุญููู
```bash
# ุงุญุชูุธ ุจูุณุฎุฉ ูู ุจูุงูุงุช Turso (ุชู ุจุงููุนู ูู ุฎุทูุฉ ุงูุชุตุฏูุฑ)
# ุงููููุงุช ููุฌูุฏุฉ ูู: scripts/migrate-to-mysql/exported-data/
```

### ุจุนุฏ ุงูุชุญููู
```bash
# ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู MySQL
mysqldump -u root -p demotasks > backup_demotasks_$(date +%Y%m%d).sql

# ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
mysql -u root -p demotasks < backup_demotasks_20250115.sql
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงุญุชูุธ ุจู Turso ูุคูุชุงู**: ูุง ุชุญุฐู ูุงุนุฏุฉ ุจูุงูุงุช Turso ููุฑุงู. ุงุญุชูุธ ุจูุง ููุฏุฉ ุฃุณุจูุน ุนูู ุงูุฃูู ููุชุฃูุฏ ูู ูุฌุงุญ ุงูุชุญููู.

2. **ูููุงุช ุงูุจูุฆุฉ**: ุฃูุดุฆ `.env.backup` ูุญูุธ ุฅุนุฏุงุฏุงุช Turso ุงููุฏููุฉ:
```bash
cp .env .env.backup
```

3. **ุงูุฅูุชุงุฌ (Production)**: ุงุฎุชุจุฑ ุงูุชุญููู ุนูู ุจูุฆุฉ ุชุฌุฑูุจูุฉ ุฃููุงู ูุจู ุชุทุจููู ุนูู ุงูุฅูุชุงุฌ.

4. **ุงูููุงุฑุณ (Indexes)**: ุจุนุฏ ุงูุชูุงู ุงูุชุฑุญููุ ูุฏ ุชุญุชุงุฌ ูุฅุถุงูุฉ ููุงุฑุณ ุนูู ุงูุฃุนูุฏุฉ ุงููุณุชุฎุฏูุฉ ูู ุงูุจุญุซ:
```sql
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_project_id ON tasks(project_id);
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
```

5. **ุงููุฑุงูุจุฉ**: ุฑุงูุจ ุฃุฏุงุก ุงูุชุทุจูู ูู ุงูุฃูุงู ุงูุฃููู ุจุนุฏ ุงูุชุญููู.

---

## โ Checklist ุงูููุงุฆู

- [ ] ุชู ุชุซุจูุช MySQL ูุชุดุบููู
- [ ] ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฌุฏุงูู
- [ ] ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ูู Turso ุจูุฌุงุญ
- [ ] ุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุฅูู MySQL ุจูุฌุงุญ
- [ ] ุชู ุชุญุฏูุซ ูููุงุช ุงูุงุชุตุงู (client.ts ู schema)
- [ ] ุชู ุชุญุฏูุซ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (.env)
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุชุทุจูู ูุงูุชุญูู ูู ุงูุจูุงูุงุช
- [ ] ุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู MySQL
- [ ] ุชู ุงูุงุญุชูุงุธ ุจูุณุฎุฉ ูู ุจูุงูุงุช Turso
- [ ] ุงูุชุทุจูู ูุนูู ุจุฏูู ุฃุฎุทุงุก

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุฑุงุฌุน ูุณู "ุงุณุชูุดุงู ุงูุฃุฎุทุงุก" ุฃุนูุงู
2. ุชุญูู ูู ูููุงุช ุงูู logs
3. ุชุฃูุฏ ูู ุฃู ุฌููุน ุงูุฎุทูุงุช ุชูุช ุจุงูุชุฑุชูุจ ุงูุตุญูุญ

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ุจูุงุณุทุฉ Cascade AI** ๐ค
